<?xml version="1.0" encoding="utf-8"?>
<Project xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <!-- Define the task from the assembly -->
  <UsingTask
    TaskName="CitationMSBuild.UpdateCitationsTask"
    AssemblyFile="$(MSBuildThisFileDirectory)..\lib\net9.0\CitationMSBuild.dll" />

  <!-- Default properties -->
  <PropertyGroup>
    <UpdateCitationsEnabled Condition="'$(UpdateCitationsEnabled)' == ''">$(UpdateCitations)</UpdateCitationsEnabled>
    <UpdateCitationsEnabled Condition="'$(UpdateCitationsEnabled)' == ''">false</UpdateCitationsEnabled>
    <CitationsOutputPath Condition="'$(CitationsOutputPath)' == ''">$(MSBuildProjectDirectory)\CITATIONS.md</CitationsOutputPath>
  </PropertyGroup>

  <!-- Hook into AfterBuild target when UpdateCitations is enabled -->
  <Target Name="UpdateCitationsAfterBuild" 
          AfterTargets="AfterBuild" 
          Condition="'$(UpdateCitationsEnabled)' == 'true'">
    <Message Text="Updating citation information for project $(MSBuildProjectName)" Importance="normal" />
    <UpdateCitationsTask
      ProjectDirectory="$(MSBuildProjectDirectory)"
      OutputPath="$(CitationsOutputPath)" />
    <Message Text="Citations updated at: $(CitationsOutputPath)" Importance="high" />
  </Target>
</Project>
